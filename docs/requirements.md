# 网站搭建项目 - 需求文档

## 1. 项目背景

### 1.1 原始手册分析

**原手册目标**：教授学生完成从零到一的网站搭建全流程。

**原手册技术栈**：
- 后端：Flask (Python)
- 前端：HTML/CSS/JavaScript
- Web 服务器：Nginx (反向代理)
- 静态博客：Hugo
- 云服务：阿里云 ECS
- 域名：NameSilo
- 证书：Let's Encrypt (Certbot)

### 1.2 原手册问题

**配置冗余问题**（约 30% 必要，70% 冗余）：

| 问题点 | 原手册做法 | 问题所在 |
|--------|-----------|----------|
| HTTPS 证书 | DNS TXT 验证 | 需等待 10+ 分钟 DNS 生效，与编程原理无关 |
| 服务管理 | Tmux 挂后台 | 临时方案，服务器重启后服务丢失 |
| 环境配置 | Windows 本地配置 | 坑多，与服务器 Linux 环境不一致 |
| 权限管理 | 全程 root 用户 | 安全隐患，Web 漏洞直接沦陷整机 |
| 调试模式 | `debug=True` | 公网暴露错误信息，安全大忌 |

**教学效率问题**：
- 只教 "What"（怎么做），不教 "Why"（为什么）
- 机械式 Copy-Paste，学生不理解原理
- Flask 和 Hugo 无业务关联，纯粹"缝合"

---

## 2. 项目目标

### 2.1 用户角色

- **讲师/助教**：需要优化手册，提升教学效果
- **实践者**：需要自己搭建网站

### 2.2 核心需求

设计三套方案：

1. **方案 A（传统教学版）**：手册的简化升级版，保留核心学习价值
2. **方案 B（Serverless 版）**：一键部署方案，国内可访问
3. **方案 C（静态版）**：纯静态博客，完全免费

---

## 3. 方案设计

### 3.1 方案 A：传统教学版（简化升级）

#### 定位
- 面向教学，让学生理解原理
- 保留 Flask + Hugo + Nginx 的核心流程
- 修复原手册的设计缺陷

#### 技术栈
```
用户 → nip.io 域名 → Nginx → ┬→ Flask API (动态，端口 8080)
                              └→ Hugo 静态文件
```

#### 与原手册对比

| 维度 | 原手册 | 方案 A |
|------|--------|--------|
| 域名 | NameSilo 购买 (~$3) | nip.io（免费） |
| 证书 | DNS TXT 验证（慢） | HTTP-01 自动验证 |
| 服务管理 | Tmux | Systemd（开机自启） |
| 权限 | root 用户 | 普通用户 + sudo |
| 调试 | debug=True | 生产模式 |
| Flask 内容 | Hello World | 博客后台 API |
| 业务关联 | 无 | Flask 为 Hugo 提供 API |

#### Flask 功能设计
- 留言板 API（POST/GET 留言）
- 访客统计 API（页面浏览量）
- Hugo 博客前端调用这些 API

#### 保留的教学价值
- Nginx 反向代理配置
- HTTPS 证书申请流程
- Linux 服务管理
- 前后端分离架构

---

### 3.2 方案 B：Serverless 一键部署版

#### 定位
- 面向实际使用
- 国内可直接访问（排除 Vercel）
- Git 推送自动部署

#### 技术栈选型

| 平台 | Flask 支持 | 静态站点 | 国内访问 | 推荐度 |
|------|-----------|---------|---------|--------|
| Zeabur | ✅ | ✅ | ✅ 稳定 | ⭐⭐⭐ 推荐 |
| Cloudflare Pages | ✅ Workers | ✅ | ✅ 快 | ⭐⭐⭐ 推荐静态 |
| EdgeOne | ✅ | ✅ | ✅ 腾讯云 | ⭐⭐ |
| 阿里云 FC | ✅ | ✅ | ✅ | ⭐⭐ 需实名 |

#### 推荐方案
- **全部放 Zeabur**：Flask + Hugo 一起部署，管理简单
- 或 **分开部署**：Hugo → Cloudflare Pages，Flask → Zeabur

#### 业务逻辑
与方案 A 相同：Flask API + Hugo 静态博客

---

## 4. 架构设计

### 4.1 业务架构

```
┌─────────────────────────────────────────────────────────┐
│                      Hugo 静态博客                        │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐                  │
│  │ 首页    │  │ 文章列表 │  │ 文章详情 │                  │
│  └────┬────┘  └────┬────┘  └────┬────┘                  │
│       │            │            │                        │
│       └────────────┴────────────┘                        │
│                     │                                    │
│                     ▼                                    │
│              ┌─────────────┐                             │
│              │  留言组件   │                              │
│              │  统计组件   │                              │
│              └──────┬──────┘                             │
└─────────────────────┼───────────────────────────────────┘
                      │ API 调用
                      ▼
┌─────────────────────────────────────────────────────────┐
│                    Flask API                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │
│  │ GET /api/   │  │ POST /api/  │  │ GET /api/   │      │
│  │ comments    │  │ comments    │  │ stats       │      │
│  └─────────────┘  └─────────────┘  └─────────────┘      │
└─────────────────────────────────────────────────────────┘
```

### 4.2 部署架构

#### 方案 A（传统服务器）
```
┌──────────────────────────────────────────────────────┐
│                   Ubuntu 服务器                       │
│                                                      │
│  ┌─────────────────────────────────────────────┐    │
│  │                  Nginx                       │    │
│  │  ┌─────────────┐    ┌─────────────────┐     │    │
│  │  │ /api/*      │    │ /myblog/*       │     │    │
│  │  │ → Flask:8080│    │ → 静态文件       │     │    │
│  │  └─────────────┘    └─────────────────┘     │    │
│  └─────────────────────────────────────────────┘    │
│                                                      │
│  ┌──────────────┐      ┌──────────────────┐         │
│  │ Flask App   │      │ Hugo 静态文件     │         │
│  │ (Systemd)   │      │ /var/www/myblog  │         │
│  └──────────────┘      └──────────────────┘         │
└──────────────────────────────────────────────────────┘
```

#### 方案 B（Serverless）
```
┌─────────────────────────────────────────────────────┐
│                     Zeabur                           │
│  ┌─────────────────┐    ┌─────────────────────┐     │
│  │   Flask API     │    │    Hugo 静态站点     │     │
│  │   (自动扩容)     │    │    (全球 CDN)       │     │
│  └─────────────────┘    └─────────────────────┘     │
└─────────────────────────────────────────────────────┘
```

---

## 5. 非目标（明确不做的事）

- ❌ 不做用户认证系统（登录/注册）
- ❌ 不做复杂的数据库设计（用 SQLite 或 JSON 文件即可）
- ❌ 不做前端框架（Hugo 原生 + 少量 JS）
- ❌ 不追求生产级高可用（这是教学项目）

---

## 6. 验收标准

### 方案 A
- [ ] 能通过 nip.io 域名访问网站
- [ ] Hugo 博客正常显示文章
- [ ] 留言功能可用（提交 + 显示）
- [ ] 访客统计功能可用
- [ ] 服务器重启后服务自动恢复
- [ ] 附带原理说明文档

### 方案 B
- [ ] Git 推送后自动部署
- [ ] 国内可直接访问（无需翻墙）
- [ ] 功能与方案 A 一致

---

## 7. 下一步计划

1. 设计 Flask API（留言板 + 访客统计）
2. 设计 Hugo 博客（调用 Flask API）
3. 编写方案 A 部署文档（简化版手册）
4. 编写方案 B 部署配置（Serverless）
